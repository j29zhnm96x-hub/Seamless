<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  
  <title>SeamlessPlayer</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="img/favicon.PNG" />
  <link rel="shortcut icon" href="img/favicon.PNG" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="img/favicon.PNG" />
  <link rel="mask-icon" href="/apple-touch-icon.png" color="#4a90e2" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="manifest" href="manifest.json" />
</head>
<body>
  <div class="app-shell" role="application" aria-label="SeamlessPlayer">
    <header class="topbar">
      <h1>SeamlessPlayer</h1>
      <div id="status" class="status" aria-live="polite">Idle</div>
    </header>

    <main class="pages" aria-label="Pages">
      <section id="page-player" class="page active" aria-label="Player Page">
        <div class="transport" aria-label="Transport Controls">
          <button id="play" class="transport-btn" aria-label="Play">
            <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="7,4 20,12 7,20"/></svg>
          </button>
          <button id="stop" class="transport-btn" aria-label="Stop">
            <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="5" width="14" height="14" rx="2"/></svg>
          </button>
          <button id="repeat" class="transport-btn" aria-label="Repeat playlist">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 2l3 3-3 3"/><path d="M3 11V9a4 4 0 014-4h13"/><path d="M7 22l-3-3 3-3"/><path d="M21 13v2a4 4 0 01-4 4H4"/></svg>
          </button>
        </div>

        <div id="playerPlaylist" class="player-playlist hidden" aria-live="polite" aria-hidden="true"></div>

        <div class="card">
          <div class="wave-wrap" aria-label="Waveform container">
            <canvas id="wave" height="160" aria-label="Waveform preview"></canvas>
            <div id="wavePlayhead" class="wave-playhead hidden" aria-hidden="true"></div>
          </div>
          <div id="nowPlayingName" class="wave-nowplaying hidden" aria-hidden="true"></div>
        </div>

        <div class="card" aria-label="Overall volume">
          <div class="rate-wrap">
            <div class="rate-label">
              <span>Volume</span>
              <span id="volumeReadout" class="rate-readout" aria-live="polite">50%</span>
            </div>
            <div class="range-wrap volume-range">
              <input id="volume" type="range" min="0" max="100" value="50" aria-label="Overall volume" />
            </div>
          </div>
        </div>

        <div class="card" aria-label="Playback rate">
          <div class="rate-wrap">
            <div class="rate-label">
              <span>Rate</span>
              <span id="rateReadout" class="rate-readout" aria-live="polite">1.00×</span>
            </div>
            <div
              id="rateJog"
              class="rate-jog"
              role="slider"
              tabindex="0"
              aria-label="Playback rate jog"
              aria-valuemin="0.5"
              aria-valuemax="2.0"
              aria-valuenow="1.0"
              aria-valuetext="1.00x"
            >
              <div class="rate-jog-track"></div>
              <div class="rate-jog-center" aria-hidden="true"></div>
              <div id="rateJogThumb" class="rate-jog-thumb" aria-hidden="true"></div>
            </div>
            <p class="hint">Drag left/right, then release to apply. Double-tap to reset.</p>
          </div>
        </div>
      </section>

      <section id="page-playlists" class="page" aria-label="Playlists Page">
        <div class="page-header">
          <h2>Playlists</h2>
          <button id="newPlaylistFromPage" class="btn-sm" aria-label="New playlist">+ New</button>
        </div>
        <ul id="playlistsList" class="playlist-list" aria-label="Saved playlists"></ul>
      </section>

      <section id="page-playlist-detail" class="page" aria-label="Playlist Detail">
        <button id="detailBack" class="detail-back" aria-label="Back to playlists">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          Back
        </button>
        <div class="detail-top">
          <h2 id="detailTitle" class="detail-title">Playlist</h2>
          <p id="detailInfo" class="detail-info">0 loops</p>
        </div>
        <div class="detail-actions">
          <button id="detailPlay" class="btn-accent" aria-label="Play playlist">
            <svg class="btn-icon" viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><polygon points="7,4 20,12 7,20"/></svg>Play
          </button>
          <button id="detailEdit" class="btn-ghost" aria-label="Edit playlist">Edit</button>
          <button id="detailDelete" class="btn-danger-text" aria-label="Delete playlist">Delete</button>
        </div>
        <div id="detailItems" class="detail-items"></div>
      </section>

      <section id="page-loops" class="page" aria-label="Audio Loops Page">
        <div class="card">
          <h2>Audio Loops</h2>
          <p class="hint">Built-ins and anything you imported during this session.</p>

          <div class="imports" aria-label="Import Loop">
            <button id="importLoop" type="button" aria-label="Import audio loop">Import Loop</button>
            <button id="pasteBtn" type="button" aria-label="Paste audio loop">Paste</button>
            <input id="fileInput" type="file" accept="audio/*,.mp3,.wav,.m4a,.aac,.aif,.aiff,.caf,.flac,.ogg" aria-label="Select audio file" class="hidden" />
          </div>

          <div class="list-section">
            <h3>Built-in</h3>
            <ul id="builtinListPage" class="list"></ul>
          </div>
          <div class="list-section">
            <h3>IMPORTED</h3>
            <ul id="uploadsListPage" class="list"></ul>
          </div>
        </div>
      </section>

      <!-- Trimmer sub-page (opens from Loops) -->
      <section id="page-trimmer" class="page" aria-label="Loop Trimmer">
        <button id="trimBack" class="detail-back" aria-label="Back to loops">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          Back
        </button>
        <div class="detail-top">
          <div class="trim-title-row">
            <h2 id="trimTitle" class="detail-title">Trim Loop</h2>
            <button id="trimRename" type="button" class="btn-ghost trim-rename" aria-label="Rename loop">Rename</button>
          </div>
          <p id="trimInfo" class="detail-info">Drag the IN/OUT cursors to adjust loop points</p>
        </div>
        <div class="trim-canvas-wrap">
          <canvas id="trimCanvas" height="200" aria-label="Trim waveform"></canvas>
          <div id="trimCursor" class="trim-playhead" aria-label="Playhead (drag to focus zoom)" tabindex="0">
            <div class="trim-playhead-line" aria-hidden="true"></div>
            <div class="trim-playhead-handle" aria-hidden="true"></div>
            <div id="trimCursorLabel" class="trim-playhead-label" aria-hidden="true">0.000s</div>
          </div>
        </div>

        <div class="trim-mark-actions" aria-label="Set loop points from playhead">
          <button id="trimSetIn" type="button" class="btn-ghost" aria-label="Set IN to playhead">Set IN</button>
          <button id="trimSetOut" type="button" class="btn-ghost" aria-label="Set OUT to playhead">Set OUT</button>
        </div>

        <div class="trim-readouts">
          <div class="trim-readout"><span class="trim-readout-label">IN</span><span id="trimInTime" class="trim-readout-val">0.000s</span></div>
          <div class="trim-readout"><span class="trim-readout-label">OUT</span><span id="trimOutTime" class="trim-readout-val">0.000s</span></div>
          <div class="trim-readout"><span class="trim-readout-label">Length</span><span id="trimDuration" class="trim-readout-val">0.000s</span></div>
        </div>
        <div class="trim-zoom">
          <label for="trimZoom" class="trim-zoom-label">Zoom</label>
          <input id="trimZoom" type="range" min="1" max="200" value="1" aria-label="Zoom level" />
        </div>
        <div class="trim-actions">
          <button id="trimPlayTest" class="btn-accent" aria-label="Play trimmed loop">
            <svg class="btn-icon" viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><polygon points="7,4 20,12 7,20"/></svg>Test Loop
          </button>
          <button id="trimStopTest" class="btn-ghost" aria-label="Stop test">Stop</button>
          <button id="trimSave" class="btn-accent" aria-label="Save trim points">Save</button>
          <button id="trimReset" class="btn-ghost" aria-label="Reset to auto">Reset</button>
        </div>
      </section>

      <section id="page-settings" class="page" aria-label="Settings Page">
        <div class="page-header">
          <h2>Settings</h2>
        </div>

        <div class="settings-section">
          <h3 class="settings-section-title">Data</h3>
          <div class="settings-group">
            <button id="exportJson" class="settings-item" type="button" aria-label="Export data">
              <span class="settings-item-main">Export Playlists &amp; Loops</span>
              <span class="settings-item-hint">Download as backup (ZIP)</span>
            </button>
            <button id="importJson" class="settings-item" type="button" aria-label="Import data">
              <span class="settings-item-main">Import Playlists &amp; Loops</span>
              <span class="settings-item-hint">Restore from backup (ZIP/JSON)</span>
            </button>
            <input id="importJsonInput" type="file" accept=".zip,application/zip,.json,application/json" class="hidden" aria-label="Import backup file" />
          </div>
        </div>

        <div class="settings-section">
          <h3 class="settings-section-title">Appearance</h3>
          <div class="settings-group">
            <div class="settings-item settings-toggle-row">
              <span class="settings-item-main">Theme</span>
              <div id="themeToggle" class="theme-toggle" role="radiogroup" aria-label="Theme">
                <button class="theme-opt active" data-theme="dark" aria-label="Dark theme">Dark</button>
                <button class="theme-opt" data-theme="light" aria-label="Light theme">Light</button>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3 class="settings-section-title">Language</h3>
          <div class="settings-group">
            <div class="settings-item settings-toggle-row">
              <span class="settings-item-main">Language</span>
              <select id="langSelect" class="settings-select" aria-label="Language">
                <option value="en" selected>English</option>
                <option value="hr">Hrvatski</option>
              </select>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3 class="settings-section-title">About</h3>
          <div class="settings-group">
            <div class="settings-item">
              <span class="settings-item-main">SeamlessPlayer</span>
              <span class="settings-item-hint">v1.0 &mdash; Gapless audio loops with Web Audio API</span>
            </div>
            <button id="settingsHelp" class="settings-item" type="button" aria-label="Help">
              <span class="settings-item-main">Help</span>
              <span class="settings-item-hint">How to use the app</span>
            </button>
          </div>
        </div>
      </section>
    </main>

    <nav class="tabbar" aria-label="Bottom Navigation">
      <button class="tab active" data-tab="player" aria-label="Player" aria-current="page">Player</button>
      <button class="tab" data-tab="playlists" aria-label="Playlists">Playlists</button>
      <button class="tab" data-tab="loops" aria-label="Audio Loops">Audio Loops</button>
      <button class="tab" data-tab="settings" aria-label="Settings">Settings</button>
    </nav>
  </div>

  <!-- Playlist overlays (kept outside app-shell so they can cover full screen) -->
  <div id="playlistOverlay" class="overlay hidden" role="dialog" aria-modal="true" aria-label="Playlist">
    <div class="overlay-card">
      <section id="playlistCreateView" aria-label="Create playlist">
        <h2>Create Playlist</h2>
        <div class="row">
          <label for="playlistName">Playlist name</label>
          <input id="playlistName" class="text-input" type="text" autocomplete="off" placeholder="My playlist" />
        </div>
        <div class="overlay-actions">
          <button id="createPlaylistBtn">Create</button>
          <button id="closePlaylistOverlay" class="secondary">Close</button>
        </div>
      </section>

      <section id="playlistEditView" class="hidden" aria-label="Edit playlist">
        <h2 id="playlistTitle">Playlist</h2>
        <div class="overlay-actions">
          <button id="playlistAddLoop">Add</button>
          <button id="playlistPlay">Play</button>
          <button id="playlistClose" class="secondary">Close</button>
        </div>
        <div id="playlistRows" class="playlist-rows" aria-label="Playlist loops"></div>
      </section>
    </div>
  </div>

  <div id="loopPickerOverlay" class="overlay hidden" role="dialog" aria-modal="true" aria-label="Choose loop">
    <div class="overlay-card">
      <h2>Choose Loop</h2>
      <div id="loopPickerList" class="picker-list" aria-label="Available loops"></div>
      <div class="overlay-actions">
        <button id="closeLoopPicker" class="secondary">Close</button>
      </div>
    </div>
  </div>

  <div id="playlistDeleteOverlay" class="overlay hidden" role="dialog" aria-modal="true" aria-label="Delete playlist confirmation">
    <div class="overlay-card">
      <h2>Delete Playlist</h2>
      <p class="hint" id="playlistDeleteText">Delete this playlist?</p>
      <div class="overlay-actions">
        <button id="confirmDeletePlaylist" class="danger" aria-label="Confirm delete playlist">Delete</button>
        <button id="cancelDeletePlaylist" class="secondary" aria-label="Cancel delete playlist">Cancel</button>
      </div>
    </div>
  </div>

  <!-- playlistActionsOverlay removed — actions now live on the detail page -->

  <canvas id="viz" aria-hidden="true"></canvas>
  <audio id="audioOut" playsinline></audio>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
