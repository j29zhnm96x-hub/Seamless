/* Mobile-first styling for Seamless Loop Player */
:root {
  --bg: #0d1117;
  --bg-alt: #161b22;
  --panel: #1f252e;
  --accent: #4a90e2;
  --accent-glow: 180 82% 55%;
  --danger: #e24a6a;
  --text: #e6edf3;
  --text-dim: #9da7b3;
  --radius-sm: 6px;
  --radius: 12px;
  --shadow: 0 4px 16px -4px rgba(0,0,0,0.45);
  --transition: 140ms cubic-bezier(.4,.2,.2,1);
  --focus-ring: 0 0 0 3px rgba(74,144,226,0.35);
  --wave-bg: #0f141b;
  --font-stack: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
html {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}
body {
  margin: 0;
  font-family: var(--font-stack);
  background: radial-gradient(circle at 30% 20%, #182635, #0d1117 70%);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  touch-action: manipulation;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

/* Prevent long-press text selection across UI (iOS can ignore body-scoped user-select) */
.app-shell, .app-shell * {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

/* Keep text selection/editing where it matters */
.app-shell input,
.app-shell textarea,
.app-shell [contenteditable="true"] {
  -webkit-user-select: text;
  user-select: text;
}

button, input, a, .tab {
  touch-action: manipulation;
}

h1 {
  font-size: clamp(1.6rem, 4.3vw, 2.4rem);
  margin: 0 0 1rem;
  letter-spacing: .5px;
  background: linear-gradient(90deg,#4a90e2,#6fa8ee 50%,#4a90e2);
  -webkit-background-clip: text;
  color: transparent;
}

.app-shell {
  max-width: 960px;
  margin: 0 auto;
  padding: 18px 18px calc(84px + env(safe-area-inset-bottom));
  display: flex;
  flex-direction: column;
  gap: 18px;
  position: relative;
  z-index: 10;
}

.topbar {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 12px;
}

.status {
  font-size: .85rem;
  color: var(--text-dim);
  min-height: 1.2em;
  white-space: nowrap;
}

.pages {
  display: block;
}

.page { display: none; }
.page.active { display: block; }

.card {
  border: 1px solid #1e2730;
  border-radius: var(--radius);
  background: linear-gradient(145deg,#141b23,#0f141b 60%);
  padding: 14px 16px;
  box-shadow: var(--shadow);
}

.hint {
  margin: 6px 0 12px;
  color: var(--text-dim);
  font-size: .9rem;
}

.loop-info {
  margin-top: 10px;
  font-size: .9rem;
  color: var(--text);
  font-weight: 500;
}

.range-label { font-size:.75rem; letter-spacing:.7px; color: var(--text-dim); }

.controls, .imports { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }

#page-playlists .controls { margin-bottom: 16px; }

.rate-wrap { display: grid; gap: 10px; }
.rate-label {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 10px;
  color: var(--text-dim);
  font-size: .9rem;
}
.rate-readout { color: var(--text); font-weight: 700; letter-spacing: .3px; }

.rate-jog {
  position: relative;
  height: 52px;
  border-radius: var(--radius);
  border: 1px solid #1e2730;
  background: var(--panel);
  overflow: hidden;
  touch-action: none;
}

.rate-jog:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.rate-jog-track {
  position: absolute;
  inset: 10px 12px;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(226,74,106,0.28), rgba(74,144,226,0.28));
  border: 1px solid #2a3542;
}

.rate-jog-center {
  position: absolute;
  top: 9px;
  bottom: 9px;
  left: 50%;
  width: 2px;
  transform: translateX(-1px);
  background: rgba(230,237,243,0.35);
}

.rate-jog-thumb {
  position: absolute;
  top: 6px;
  bottom: 6px;
  left: 50%;
  width: 54px;
  transform: translateX(-50%);
  border-radius: 999px;
  background: rgba(74,144,226,0.18);
  border: 1px solid rgba(74,144,226,0.45);
  box-shadow: 0 6px 16px -10px rgba(0,0,0,0.55);
}

button, .btn {
  appearance: none;
  border: none;
  background: var(--accent);
  color: #fff;
  padding: 12px 18px;
  font-size: 15px;
  font-weight: 600;
  letter-spacing: .3px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  position: relative;
  transition: var(--transition);
  box-shadow: 0 2px 6px -2px rgba(0,0,0,.4),0 0 0 1px rgba(255,255,255,.05);
}
button:hover, .btn:hover { filter: brightness(1.12); }
button:active, .btn:active { transform: translateY(1px); }
button:focus-visible { outline: none; box-shadow: var(--focus-ring); }

button.secondary { background: var(--panel); color: var(--text); }
button.secondary:hover { background: #242b35; }
button.danger { background: var(--danger); }

.danger { background: var(--danger); }

.range-wrap { display: flex; align-items: center; gap: 8px; }
.range-wrap input[type=range] { width: 180px; accent-color: var(--accent); }

#loopInfo { font-size: .9rem; color: var(--text); font-weight: 500; }

#dropZone {
  border: 2px dashed #2a3542;
  padding: 16px 18px;
  border-radius: var(--radius);
  background: var(--panel);
  font-size: .85rem;
  color: var(--text-dim);
  transition: var(--transition);
}
#dropZone.drag-hover { border-color: var(--accent); background: #1b2734; color: var(--text); }

.settings-wave-wrap { display: flex; flex-direction: column; gap: 14px; }
@media (min-width: 860px) { .settings-wave-wrap { flex-direction: row; align-items: flex-start; } }

#wave {
  width: 100%;
  height: auto;
  aspect-ratio: 4 / 1;
  background: var(--wave-bg);
  border: 1px solid #1e2730;
  border-radius: var(--radius-sm);
  display: block;
}

.wave-wrap {
  position: relative;
}

.wave-nowplaying {
  position: absolute;
  left: 50%;
  bottom: 8px;
  transform: translateX(-50%);
  max-width: calc(100% - 18px);
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(0, 0, 0, 0.35);
  border: 1px solid rgba(255, 255, 255, 0.08);
  color: var(--text);
  font-size: .85rem;
  font-weight: 650;
  letter-spacing: .2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  pointer-events: none;
}

/* Landscape visualization overlay */
#viz {
  display: none;
}

html.landscape body {
  overflow: hidden;
}

html.landscape .app-shell {
  display: none !important;
}

html.landscape #viz {
  display: block;
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  z-index: 9999;
  pointer-events: none;
}

html.landscape .overlay {
  display: none !important;
}

fieldset.settings {
  border: 1px solid #1e2730;
  border-radius: var(--radius);
  padding: 14px 16px 18px;
  background: linear-gradient(145deg,#141b23,#0f141b 60%);
  min-width: 260px;
  flex: 0 0 300px;
  position: relative;
}
fieldset.settings legend { padding: 0 6px; font-weight: 600; letter-spacing: .4px; }
.settings-grid { display: grid; gap: 10px; }
.settings-grid .row { display: flex; gap: 10px; align-items: center; }
.settings-grid label { flex: 1; font-size: .75rem; text-transform: uppercase; letter-spacing: .8px; color: var(--text-dim); }
.settings-grid input { flex: 0 0 90px; background: #10171f; border: 1px solid #1e2730; color: var(--text); padding: 6px 8px; border-radius: var(--radius-sm); font-size: .8rem; }
.settings-grid input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 2px rgba(74,144,226,.3); }

.toggle-panel-btn { position: absolute; top: 6px; right: 6px; background: var(--panel); border: 1px solid #2a3542; padding: 4px 10px; font-size: .7rem; letter-spacing: .7px; border-radius: var(--radius-sm); }
.toggle-panel-btn:hover { background:#242f3b; }

.hidden { display: none !important; }

.overlay {
  position: fixed;
  inset: 0;
  z-index: 2000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 18px;
  background: rgba(0,0,0,0.55);
}

.overlay-card {
  width: min(720px, 100%);
  max-height: min(82vh, 680px);
  overflow: auto;
  border: 1px solid #1e2730;
  border-radius: var(--radius);
  background: linear-gradient(145deg,#141b23,#0f141b 60%);
  box-shadow: var(--shadow);
  padding: 14px 16px;
}

.overlay-card h2 {
  margin: 0 0 10px;
  font-size: 1.05rem;
  letter-spacing: .4px;
}

.overlay-actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
  margin-top: 12px;
}

.text-input {
  width: 100%;
  padding: 10px 12px;
  border-radius: var(--radius-sm);
  border: 1px solid #2a3542;
  background: #10171f;
  color: var(--text);
  font-size: .95rem;
}

.text-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(74,144,226,.3);
}

.playlist-rows {
  display: grid;
  gap: 10px;
  margin-top: 12px;
}

.pl-row {
  display: grid;
  grid-template-columns: 1fr 120px;
  gap: 10px;
  align-items: center;
  padding: 10px;
  border: 1px solid #1e2730;
  border-radius: var(--radius-sm);
  background: var(--panel);
}

.pl-row.dragging {
  opacity: 0.85;
  outline: 1px solid rgba(74,144,226,0.55);
}

.pl-name-wrap {
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
}

.pl-handle {
  width: 44px;
  height: 44px;
  display: grid;
  place-items: center;
  border-radius: var(--radius-sm);
  background: #10171f;
  border: 1px solid #2a3542;
  color: var(--text-dim);
  font-weight: 800;
  letter-spacing: .6px;
  user-select: none;
  -webkit-user-select: none;
  touch-action: none;
  cursor: grab;
}

.pl-row.dragging .pl-handle { cursor: grabbing; }

.pl-name {
  display: block;
  padding: 10px 12px;
  border-radius: var(--radius-sm);
  background: #10171f;
  border: 1px solid #2a3542;
  color: var(--text);
  font-weight: 600;
  letter-spacing: .2px;
}

.pl-reps {
  width: 100%;
  padding: 10px 10px;
  border-radius: var(--radius-sm);
  border: 1px solid #2a3542;
  background: #10171f;
  color: var(--text);
  font-size: .95rem;
}

.pl-reps:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(74,144,226,.3);
}

.pl-reps[disabled] { opacity: .55; }

.picker-list {
  display: grid;
  gap: 10px;
  margin-top: 8px;
}

.picker-list button {
  width: 100%;
  text-align: left;
  background: var(--panel);
  color: var(--text);
  border: 1px solid #2a3542;
  box-shadow: none;
}

.picker-list button:hover { background: #242b35; }

.url-input { min-width: 240px; flex: 1; padding: 10px 12px; border-radius: var(--radius-sm); border: 1px solid #2a3542; background: #10171f; color: var(--text); font-size: .85rem; }
.url-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 2px rgba(74,144,226,.3); }

.source-badge { display:inline-block; margin-left:4px; padding:2px 6px; font-size:.65rem; background:#243241; color:var(--text-dim); border-radius:999px; letter-spacing:.5px; }

.footer-note { margin-top: 24px; font-size: .65rem; text-transform: uppercase; letter-spacing: .8px; color: #5d6672; text-align: center; }

.list-section { margin-top: 14px; }
.list-section h3 { margin: 10px 0 8px; font-size: .85rem; letter-spacing: .8px; text-transform: uppercase; color: var(--text-dim); }

.list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: 10px;
}

.plst-item {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  align-items: center;
}

.playlist-card {
  display: grid;
  grid-template-columns: 1fr auto auto;
  gap: 8px;
  align-items: center;
  padding: 6px 8px;
  border-radius: var(--radius-sm);
  border: 1px solid #1e2730;
  background: var(--panel);
}

.playlist-card-name {
  min-width: 0;
  font-weight: 700;
  letter-spacing: .2px;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.playlist-card-play {
  height: 44px;
  padding: 0 12px;
  font-size: 14px;
  background: none;
  border: none;
  color: var(--accent);
  display: flex;
  align-items: center;
  justify-content: center;
}

.play-icon {
  font-size: 18px;
  line-height: 1;
}

.playlist-card-menu {
  width: 44px;
  height: 44px;
  padding: 0;
  display: grid;
  place-items: center;
  font-size: 18px;
  line-height: 1;
  font-weight: 800;
  letter-spacing: 2px;
  border-radius: var(--radius-sm);
  background: none;
  color: var(--text);
  box-shadow: none;
  border: none;
  transform: translateY(-6px);
}

.playlist-card-menu:hover { background: none; }

.plst-actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.plst-actions button {
  padding: 10px 12px;
  font-size: 14px;
}

/* Swipe-left to delete (uploads only) */
.preset-item {
  position: relative;
  overflow: hidden;
  border-radius: var(--radius-sm);
  touch-action: pan-y;
}

.preset-content {
  transform: translateX(0);
  transition: transform 200ms ease;
}

.preset-item.swiping .preset-content {
  transition: none;
}

.preset-delete {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  width: 84px;
  border: none;
  border-radius: 0;
  background: var(--danger);
  color: #fff;
  font-weight: 700;
  letter-spacing: .3px;
  box-shadow: none;
  display: flex;
  align-items: center;
  justify-content: center;
  transform: translateX(100%);
  transition: transform 200ms ease;
}

.preset-item.open .preset-content {
  transform: translateX(-84px);
}

.preset-item.open .preset-delete {
  transform: translateX(0);
}

/* Desktop affordance */
@media (hover: hover) {
  .preset-item:hover .preset-delete,
  .preset-item:focus-within .preset-delete {
    transform: translateX(0);
  }
  .preset-item:hover .preset-content,
  .preset-item:focus-within .preset-content {
    transform: translateX(-84px);
  }
}

.list li button {
  width: 100%;
  text-align: left;
  background: var(--panel);
  color: var(--text);
  border: 1px solid #2a3542;
  box-shadow: none;
}
.list li button:hover { background: #242b35; }

.tabbar {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 10px 14px calc(10px + env(safe-area-inset-bottom));
  display: flex;
  justify-content: center;
  z-index: 50;
  background: rgba(13,17,23,.55);
  -webkit-backdrop-filter: blur(14px);
  backdrop-filter: blur(14px);
  border-top: 1px solid rgba(255,255,255,.06);
}

.tabbar .tab {
  background: transparent;
  border: 1px solid rgba(255,255,255,.10);
  color: var(--text-dim);
  box-shadow: none;
  padding: 10px 14px;
  border-radius: 999px;
  font-weight: 650;
}

.tabbar .tab.active {
  color: #fff;
  border-color: rgba(255,255,255,.18);
  background: linear-gradient(90deg, rgba(74,144,226,.9), rgba(170,110,255,.75));
}

.tabbar .tab + .tab { margin-left: 10px; }

#audioOut { display: none; }

/* Smooth fade for dynamic states */
.fade { animation: fade .35s ease; }
@keyframes fade { from { opacity:0; transform: translateY(4px);} to { opacity:1; transform: translateY(0);} }

/* Scroll behavior for safe-area long pages */
html { scroll-behavior: smooth; }

/* When the document has no need to scroll, hide scrollbars and prevent scrolling. */
html.no-scroll, body.no-scroll {
  overflow: hidden !important;
}

/* Ensure interactive form controls still allow selection and scrolling if focused. */
.no-scroll input:focus, .no-scroll textarea:focus, .no-scroll [contenteditable="true"]:focus {
  outline: none;
}

/* Dark and high-contrast considerations */
@media (prefers-color-scheme: light) {
  :root { --bg: #f4f7fa; --bg-alt:#e8edf3; --panel:#ffffff; --text:#1d242b; --text-dim:#5a6672; --wave-bg:#ffffff; }
  body { background: linear-gradient(165deg,#ffffff,#e8edf3 70%); }
  #dropZone { background:#ffffff; }
  fieldset.settings { background: linear-gradient(145deg,#f4f7fa,#e8edf3); }
}

/* Responsive adjustments */
@media (max-width: 520px) {
  .controls button, .imports button { flex: 1 1 auto; }
  .range-wrap { width:100%; }
  .range-wrap input[type=range] { flex:1; }
  fieldset.settings { flex:1 1 100%; }
  .settings-wave-wrap { flex-direction: column; }
}
