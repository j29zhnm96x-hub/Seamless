/* SeamlessPlayer — Modern UI */
:root {
  --bg: #111114;
  --surface: #1a1a1f;
  --surface-2: #222228;
  --border: rgba(255,255,255,0.06);
  --border-2: rgba(255,255,255,0.10);
  --accent: #5b8def;
  --accent-soft: rgba(91,141,239,0.10);
  --accent-mid: rgba(91,141,239,0.25);
  --danger: #d94f4f;
  --danger-soft: rgba(217,79,79,0.10);
  --text: #dddde2;
  --text-2: #82828c;
  --text-3: #55555e;
  --radius: 8px;
  --radius-lg: 14px;
  --shadow: 0 2px 10px rgba(0,0,0,0.38), 0 14px 34px -14px rgba(0,0,0,0.72);
  --transition: 120ms ease;
  --focus: 0 0 0 2px var(--accent-mid);
  --wave-bg: #141418;
  --font: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;
}

*{box-sizing:border-box}
html,body{height:100%}
html{-webkit-text-size-adjust:100%;text-size-adjust:100%;scroll-behavior:smooth}
body{
  margin:0;
  font-family:var(--font);
  font-size:14px;
  line-height:1.45;
  background:var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  touch-action:manipulation;
  -webkit-touch-callout:none;
  -webkit-user-select:none;
  user-select:none;
}

.app-shell,.app-shell *{-webkit-user-select:none;user-select:none;-webkit-touch-callout:none}
.app-shell input,.app-shell textarea,.app-shell [contenteditable="true"]{-webkit-user-select:text;user-select:text}
button,input,a,.tab{touch-action:manipulation}

/* -------- Layout -------- */
.app-shell{
  max-width:540px;
  margin:0 auto;
  padding:0 16px calc(68px + env(safe-area-inset-bottom));
  display:flex;
  flex-direction:column;
  gap:0;
  position:relative;
  z-index:10;
}

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 0 10px;
}
.topbar h1{
  font-size:18px;
  font-weight:700;
  margin:0;
  letter-spacing:-.3px;
  color:var(--text);
}
.status{
  font-size:12px;
  color:var(--text-2);
  min-height:1em;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:55%;
  text-align:right;
}

.pages{display:block}
.page{display:none}
.page.active{display:block;animation:pageIn .2s ease}
@keyframes pageIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* -------- Shared elements -------- */
.hidden{display:none!important}

.hint{
  margin:4px 0 10px;
  color:var(--text-2);
  font-size:13px;
  line-height:1.4;
}

.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:14px;
  margin-bottom:12px;
  box-shadow:var(--shadow);
}

/* -------- Buttons -------- */
button,.btn{
  appearance:none;
  border:none;
  font-family:var(--font);
  font-size:13px;
  font-weight:600;
  cursor:pointer;
  border-radius:var(--radius);
  padding:9px 16px;
  transition:var(--transition);
  position:relative;
}
button:focus-visible,.btn:focus-visible{outline:none;box-shadow:var(--focus)}
button:active,.btn:active{transform:scale(.97)}

.btn-accent,.btn-primary{
  background:var(--accent);
  color:#fff;
  box-shadow:var(--shadow);
}
.btn-accent:hover{filter:brightness(1.1)}

.btn-ghost{
  background:transparent;
  color:var(--text);
  border:1px solid var(--border-2);
  box-shadow:none;
}
.btn-ghost:hover{background:var(--surface-2)}

.btn-danger{background:var(--danger);color:#fff;box-shadow:none}
.btn-danger:hover{filter:brightness(1.08)}
.btn-danger-text{background:none;border:none;color:var(--danger);box-shadow:none;padding:6px 10px}
.btn-danger-text:hover{background:var(--danger-soft)}
.btn-icon{vertical-align:-2px;margin-right:4px}

button.secondary{background:var(--surface-2);color:var(--text);border:1px solid var(--border-2);box-shadow:none}
button.secondary:hover{background:var(--surface)}
button.danger{background:var(--danger);color:#fff}
.danger{background:var(--danger)}

.btn-sm{
  font-size:12px;
  padding:7px 14px;
  border-radius:var(--radius);
  background:var(--accent);
  color:#fff;
  box-shadow:none;
}

/* -------- Transport controls (Player top) -------- */
.transport{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:16px;
  padding:10px 0 14px;
}
.transport-btn{
  width:52px;
  height:52px;
  border-radius:50%;
  display:grid;
  place-items:center;
  background:var(--surface);
  border:1px solid var(--border-2);
  color:var(--text);
  box-shadow:var(--shadow);
  padding:0;
  transition:var(--transition);
}
.transport-btn:hover{background:var(--surface-2)}
.transport-btn:active{transform:scale(.92)}
.transport-btn svg{width:22px;height:22px}
.transport-btn.active{
  color:var(--accent);
  border-color:var(--accent-mid);
  background:var(--accent-soft);
}

.player-playlist{
  margin:-6px auto 10px;
  width:fit-content;
  max-width:100%;
  padding:6px 12px;
  border-radius:999px;
  background:var(--surface);
  border:1px solid var(--border);
  box-shadow:var(--shadow);
  color:var(--text-2);
  font-size:12px;
  font-weight:700;
  letter-spacing:.1px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* -------- Waveform -------- */
.wave-wrap{position:relative}
#wave{
  width:100%;
  height:auto;
  aspect-ratio:4/1;
  background:var(--wave-bg);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:block;
}

.wave-playhead{
  position:absolute;
  top:0;
  bottom:0;
  width:0;
  border-left:2px solid var(--accent);
  box-shadow:0 0 0 1px var(--accent-mid), 0 0 10px var(--accent-soft);
  /* Purple look without introducing new hard-coded colors. */
  filter:hue-rotate(70deg) saturate(1.25);
  pointer-events:none;
  will-change:transform;
  transform:translateX(0);
}

.wave-nowplaying{
  margin-top:10px;
  color:var(--text);
  font-size:13px;
  font-weight:600;
  line-height:1.25;
  text-align:center;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:100%;
}

/* -------- Volume / Rate controls -------- */
.controls,.imports{display:flex;flex-wrap:wrap;gap:10px;align-items:center}

.rate-wrap{display:grid;gap:8px}
.rate-label{
  display:flex;align-items:baseline;justify-content:space-between;
  color:var(--text-2);font-size:13px;
}
.rate-readout{color:var(--text);font-weight:700;font-size:13px}

.range-wrap{display:flex;align-items:center;gap:8px}
.range-wrap input[type=range]{width:100%;accent-color:var(--accent)}
.volume-range{width:100%}
.volume-range input[type=range]{width:100%}

.rate-jog{
  position:relative;height:48px;
  border-radius:var(--radius);border:1px solid var(--border-2);
  background:var(--surface);overflow:hidden;touch-action:none;
  box-shadow:var(--shadow);
}
.rate-jog:focus-visible{outline:none;box-shadow:var(--focus)}
.rate-jog-track{
  position:absolute;inset:10px 12px;border-radius:999px;
  background:linear-gradient(90deg,rgba(217,79,79,0.18),rgba(91,141,239,0.18));
  border:1px solid var(--border);
}
.rate-jog-center{
  position:absolute;top:9px;bottom:9px;left:50%;width:1px;
  background:rgba(255,255,255,0.15);
}
.rate-jog-thumb{
  position:absolute;top:6px;bottom:6px;left:50%;width:48px;
  transform:translateX(-50%);border-radius:999px;
  background:var(--accent-soft);border:1px solid var(--accent-mid);
}

/* -------- Preserve-pitch toggle -------- */
.preserve-pitch-row{
  display:flex;align-items:center;gap:10px;
  margin-top:8px;
}
.preserve-pitch-toggle{
  position:relative;width:40px;height:22px;
  border-radius:999px;
  background:var(--surface-2);border:1px solid var(--border-2);
  padding:0;cursor:pointer;box-shadow:none;
  transition:background 200ms ease,border-color 200ms ease;
}
.preserve-pitch-toggle:active{transform:none}
.preserve-pitch-toggle[aria-pressed="true"]{
  background:var(--accent);border-color:var(--accent);
}
.preserve-pitch-dot{
  position:absolute;top:2px;left:2px;width:16px;height:16px;
  border-radius:50%;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,0.25);
  transition:transform 200ms ease;
  pointer-events:none;
}
.preserve-pitch-toggle[aria-pressed="true"] .preserve-pitch-dot{
  transform:translateX(18px);
}
.preserve-pitch-label{
  font-size:13px;color:var(--text-2);cursor:pointer;
  -webkit-user-select:none;user-select:none;
}

#loopInfo{font-size:13px;color:var(--text);font-weight:500}

/* -------- Page headers -------- */
.page-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 0 12px;
}
.page-header h2{
  margin:0;font-size:17px;font-weight:700;letter-spacing:-.2px;
}

/* -------- Playlists list -------- */
.playlist-list{
  list-style:none;margin:0;padding:0;display:grid;gap:2px;
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:hidden;
  background:var(--surface);
  box-shadow:var(--shadow);
}

.playlist-empty{
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px 14px;
  min-height:64px;
}
.playlist-empty .hint{
  margin:0;
  text-align:center;
}
.playlist-list-row{
  display:flex;
  align-items:stretch;
  background:var(--surface);
  border-bottom:1px solid var(--border);
}
.playlist-list-row:last-child{border-bottom:none}
.playlist-list-row:first-child{border-radius:var(--radius) var(--radius) 0 0}
.playlist-list-row:last-child{border-radius:0 0 var(--radius) var(--radius)}
.playlist-list-row:only-child{border-radius:var(--radius)}
.playlist-list-row:hover,.playlist-list-row:active{background:var(--surface-2)}

.playlist-list-item{
  flex:1 1 auto;
  display:flex;align-items:center;
  padding:13px 14px;
  background:transparent;
  border:none;
  color:var(--text);font-weight:500;font-size:14px;
  cursor:pointer;transition:var(--transition);
  width:100%;text-align:left;
  box-shadow:none;
  border-radius:0;
}
.playlist-list-item:hover,.playlist-list-item:active{background:transparent}
.playlist-list-item .pl-item-name{min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.playlist-list-item .pl-item-count{
  margin-left:auto;font-size:12px;color:var(--text-3);font-weight:400;
}
.playlist-list-item .pl-item-chevron{
  margin-left:8px;color:var(--text-3);font-size:16px;
}

.playlist-list-play{
  flex:0 0 44px;
  width:44px;
  display:grid;
  place-items:center;
  padding:0;
  border:none;
  border-left:1px solid var(--border);
  background:transparent;
  color:var(--text-2);
  box-shadow:none;
  cursor:pointer;
  transition:var(--transition);
}
.playlist-list-play:hover{color:var(--accent)}
.playlist-list-play svg{width:18px;height:18px}

/* -------- Playlist detail page -------- */
.detail-back{
  display:inline-flex;align-items:center;gap:4px;
  background:none;border:none;color:var(--accent);
  font-size:13px;font-weight:600;padding:8px 0;box-shadow:none;
}
.detail-back:hover{opacity:.8}
.detail-back svg{width:18px;height:18px}

.detail-top{padding:4px 0 8px}
.detail-title{margin:0;font-size:22px;font-weight:700;letter-spacing:-.4px}
.detail-info{margin:2px 0 0;color:var(--text-2);font-size:13px}

.trim-title-row{display:flex;align-items:center;gap:10px}
.trim-title-row .detail-title{flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.trim-rename{padding:7px 12px;font-size:12px;box-shadow:none}

.detail-actions{
  display:flex;gap:8px;padding:8px 0 16px;
}

.detail-items{display:grid;gap:0}

.detail-loop{
  display:grid;
  grid-template-columns:1fr;
  gap:4px;
  padding:12px 14px;
  background:var(--surface);
  border-bottom:1px solid var(--border);
  transition:var(--transition);
}
.detail-loop:first-child{border-radius:var(--radius) var(--radius) 0 0}
.detail-loop:last-child{border-radius:0 0 var(--radius) var(--radius);border-bottom:none}
.detail-loop:only-child{border-radius:var(--radius)}

.detail-loop-header{
  display:flex;align-items:center;gap:10px;
}
.detail-loop-name{
  font-weight:600;font-size:14px;color:var(--text);
  min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  flex:1;
}
.detail-loop-reps{
  font-size:12px;color:var(--text-2);white-space:nowrap;
}

/* Edit mode for detail items */
.detail-loop-edit{
  display:grid;
  grid-template-columns:1fr;
  gap:6px;
  padding:10px 12px;
  background:var(--surface);
  border-bottom:1px solid var(--border);
}
.detail-loop-edit:first-child{border-radius:var(--radius) var(--radius) 0 0}
.detail-loop-edit:last-child{border-radius:0 0 var(--radius) var(--radius);border-bottom:none}
.detail-loop-edit:only-child{border-radius:var(--radius)}

.detail-edit-top{
  display:flex;align-items:center;gap:8px;
}
.detail-edit-handle{
  width:36px;height:36px;display:grid;place-items:center;
  background:var(--surface-2);border:1px solid var(--border-2);
  border-radius:6px;color:var(--text-2);font-weight:800;font-size:16px;
  cursor:grab;touch-action:none;-webkit-user-select:none;user-select:none;
  flex-shrink:0;
}
.detail-loop-edit.dragging .detail-edit-handle{cursor:grabbing}
.detail-loop-edit.dragging{opacity:.85;outline:1px solid var(--accent-mid)}

.detail-edit-name{
  flex:1;min-width:0;font-weight:600;font-size:13px;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.detail-edit-remove{
  width:32px;height:32px;display:grid;place-items:center;
  background:none;border:1px solid var(--border-2);border-radius:6px;
  color:var(--danger);font-size:16px;padding:0;box-shadow:none;
  flex-shrink:0;
}
.detail-edit-remove:hover{background:var(--danger-soft)}

.detail-edit-controls{
  display:grid;grid-template-columns:1fr 1fr;gap:8px;
  padding-left:44px; /* align with name after handle */
}
.detail-ctrl-group{display:flex;flex-direction:column;gap:3px}
.detail-ctrl-label{font-size:11px;color:var(--text-3);text-transform:uppercase;letter-spacing:.5px;font-weight:600}
.detail-ctrl-group input[type=range]{
  width:100%;accent-color:var(--accent);height:22px;
}
.detail-ctrl-group input[type=number]{
  width:100%;padding:6px 8px;background:var(--surface-2);
  border:1px solid var(--border-2);border-radius:6px;
  color:var(--text);font-size:13px;
}
.detail-ctrl-group input[type=number]:focus{
  outline:none;border-color:var(--accent);box-shadow:var(--focus);
}
.detail-ctrl-val{font-size:11px;color:var(--text-2);text-align:right}

.detail-add-btn{
  margin-top:8px;width:100%;text-align:center;
  background:var(--surface);border:1px dashed var(--border-2);
  color:var(--text-2);font-size:13px;padding:12px;
  border-radius:var(--radius);box-shadow:none;
}
.detail-add-btn:hover{border-color:var(--accent);color:var(--accent)}

/* -------- Audio Loops page -------- */
.list-section{margin-top:12px}
.list-section h3{
  margin:0 0 6px;font-size:11px;font-weight:700;
  text-transform:uppercase;letter-spacing:.8px;color:var(--text-3);
}
.list{
  list-style:none;margin:0;padding:0;display:grid;gap:2px;
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:hidden;
  background:var(--surface);
  box-shadow:var(--shadow);
}
.list li > button{
  width:100%;text-align:left;
  background:var(--surface);color:var(--text);
  border:none;border-bottom:1px solid var(--border);
  box-shadow:none;padding:11px 14px;font-size:14px;border-radius:0;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  min-width:0;max-width:100%;display:block;
}
.list li:first-child > button{border-radius:var(--radius) var(--radius) 0 0}
.list li:last-child > button{border-radius:0 0 var(--radius) var(--radius);border-bottom:none}
.list li:only-child > button{border-radius:var(--radius)}
.list li > button:hover{background:var(--surface-2)}

/* Swipe-to-delete */
.preset-item{position:relative;overflow:hidden;border-radius:0;touch-action:pan-y;background:var(--surface);border-bottom:1px solid var(--border)}
.list li:last-child .preset-item{border-bottom:none}
.list li:first-child .preset-item{border-radius:var(--radius) var(--radius) 0 0}
.list li:last-child .preset-item{border-radius:0 0 var(--radius) var(--radius)}
.list li:only-child .preset-item{border-radius:var(--radius)}

.preset-content{display:flex;align-items:stretch;width:100%;transform:translateX(0);transition:transform 200ms ease}
.preset-item.swiping .preset-content{transition:none}

.preset-play{
  flex:1 1 auto;min-width:0;
  background:transparent;color:var(--text);
  border:none;box-shadow:none;
  padding:11px 14px;font-size:14px;font-weight:500;
  text-align:left;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  max-width:100%;display:block;
}
.preset-play:hover{background:var(--surface-2)}
.preset-trim{
  flex:0 0 44px;width:44px;
  background:none;border:none;border-left:1px solid var(--border);
  color:var(--text-2);font-size:16px;padding:0;box-shadow:none;
  display:grid;place-items:center;cursor:pointer;border-radius:0;
}
.preset-trim svg{width:18px;height:18px}
.preset-trim:hover{color:var(--accent);background:var(--accent-soft)}
.preset-delete{
  position:absolute;top:0;right:0;bottom:0;width:76px;
  border:none;border-radius:0;background:var(--danger);
  color:#fff;font-weight:700;font-size:12px;letter-spacing:.3px;
  box-shadow:none;display:flex;align-items:center;justify-content:center;
  transform:translateX(100%);transition:transform 200ms ease;
}
.preset-item.open .preset-content{transform:translateX(-76px)}
.preset-item.open .preset-delete{transform:translateX(0)}
@media(hover:hover){
  .preset-item:hover .preset-delete,.preset-item:focus-within .preset-delete{transform:translateX(0)}
  .preset-item:hover .preset-content,.preset-item:focus-within .preset-content{transform:translateX(-76px)}
}

/* -------- Loop Archive — search, categories, info -------- */
.loops-search-wrap{margin-bottom:10px}
.loops-search{width:100%;font-size:14px}

.loops-category{margin-top:12px}
.loops-category-header{
  display:flex;align-items:center;gap:6px;
  width:100%;background:none;border:none;box-shadow:none;
  color:var(--text-3);font-size:11px;font-weight:700;
  text-transform:uppercase;letter-spacing:.8px;
  padding:6px 2px;cursor:pointer;border-radius:0;
}
.loops-category-header:hover{color:var(--text-2)}
.loops-category-header:active{transform:none}
.loops-cat-chevron{font-size:10px;width:14px;text-align:center;flex-shrink:0}
.loops-cat-name{flex:1;text-align:left}
.loops-cat-count{font-size:10px;color:var(--text-3);font-weight:400}
.loops-category.collapsed .list{display:none}

.preset-info{
  flex:0 0 40px;width:40px;
  background:none;border:none;border-left:1px solid var(--border);
  color:var(--text-3);font-size:16px;padding:0;box-shadow:none;
  display:grid;place-items:center;cursor:pointer;border-radius:0;
}
.preset-info svg{width:16px;height:16px}
.preset-info:hover{color:var(--accent);background:var(--accent-soft)}

.user-preset-name{color:var(--accent)}
.builtin-item .preset-play{color:var(--text)}

/* Loop Info page */
.loop-info-details{
  margin-top:16px;
  border:1px solid var(--border);border-radius:var(--radius);
  overflow:hidden;background:var(--surface);box-shadow:var(--shadow);
}
.loop-info-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 14px;border-bottom:1px solid var(--border);
}
.loop-info-row:last-child{border-bottom:none}
.loop-info-label{font-size:13px;font-weight:600;color:var(--text-2)}
.loop-info-val{font-size:13px;color:var(--text)}
.loop-info-desc-row{flex-direction:column;align-items:stretch;gap:6px}
.loop-info-desc-input{resize:vertical;min-height:60px;font-size:13px}
.loop-info-desc-text{margin:0;font-size:13px;line-height:1.5;color:var(--text-2);white-space:pre-wrap;word-break:break-word}

/* -------- Loop Trimmer -------- */
.trim-canvas-wrap{
  position:relative;margin:8px 0 12px;
  border:1px solid var(--border);border-radius:var(--radius);
  overflow:hidden;background:var(--wave-bg);
  touch-action:none;
  box-shadow:var(--shadow);
}
#trimCanvas{
  width:100%;height:auto;aspect-ratio:3/1;display:block;
  cursor:crosshair;
}

.trim-playhead{
  position:absolute;
  top:0;bottom:0;
  left:0;
  transform:translateX(-1px);
  width:2px;
  pointer-events:auto;
  touch-action:none;
}
.trim-playhead:focus-visible{outline:none;box-shadow:var(--focus);border-radius:2px}
.trim-playhead-line{
  position:absolute;left:0;top:0;bottom:0;width:2px;
  background:var(--accent);
  opacity:.95;
}
.trim-playhead-handle{
  position:absolute;
  left:50%;bottom:10px;
  width:18px;height:18px;
  transform:translateX(-50%);
  border-radius:999px;
  background:var(--surface);
  border:1px solid var(--accent-mid);
  box-shadow:var(--shadow);
}
.trim-playhead-label{
  position:absolute;
  top:8px;left:50%;transform:translateX(-50%);
  padding:3px 8px;
  border-radius:999px;
  background:var(--surface);
  border:1px solid var(--border);
  color:var(--text);
  font-size:12px;
  font-weight:700;
  font-variant-numeric:tabular-nums;
  white-space:nowrap;
  pointer-events:none;
}

.trim-mark-actions{
  display:flex;
  gap:8px;
  margin:10px 0 12px;
}
.trim-mark-actions button{flex:1 1 auto;min-width:0;text-align:center}

.trim-readouts{
  display:flex;gap:0;margin-bottom:10px;
  border:1px solid var(--border);border-radius:var(--radius);
  overflow:hidden;
  box-shadow:var(--shadow);
}
.trim-readout{
  flex:1;display:flex;flex-direction:column;align-items:center;
  padding:8px 6px;background:var(--surface);
  border-right:1px solid var(--border);
}
.trim-readout:last-child{border-right:none}
.trim-readout-label{
  font-size:10px;font-weight:700;text-transform:uppercase;
  letter-spacing:.6px;color:var(--text-3);
}
.trim-readout-val{
  font-size:14px;font-weight:700;color:var(--text);
  font-variant-numeric:tabular-nums;
}
.trim-zoom{
  display:flex;align-items:center;gap:10px;
  margin-bottom:14px;padding:0 2px;
}
.trim-zoom-label{
  font-size:11px;font-weight:600;text-transform:uppercase;
  letter-spacing:.5px;color:var(--text-2);white-space:nowrap;
}
.trim-zoom input[type=range]{
  flex:1;accent-color:var(--accent);
}
.trim-actions{
  display:flex;gap:8px;flex-wrap:wrap;
}
.trim-actions button{flex:1 1 auto;min-width:0;text-align:center}

/* -------- New Settings page -------- */
.settings-section{margin-bottom:16px}
.settings-section-title{
  margin:0 0 6px;font-size:11px;font-weight:700;
  text-transform:uppercase;letter-spacing:.8px;color:var(--text-3);
  padding:0 2px;
}
.settings-group{
  border:1px solid var(--border);border-radius:var(--radius);
  overflow:hidden;
  background:var(--surface);
  box-shadow:var(--shadow);
}
.settings-item{
  display:flex;flex-direction:column;gap:2px;
  width:100%;padding:13px 14px;
  background:var(--surface);color:var(--text);
  border:none;border-bottom:1px solid var(--border);
  font-size:14px;font-weight:500;text-align:left;
  cursor:pointer;transition:var(--transition);
  border-radius:0;box-shadow:none;
}
.settings-item:last-child{border-bottom:none}
.settings-item:hover,.settings-item:active{background:var(--surface-2)}
.settings-item-main{font-weight:600;font-size:14px}
.settings-item-hint{font-size:12px;color:var(--text-2);font-weight:400}

.settings-toggle-row{
  flex-direction:row;align-items:center;justify-content:space-between;
  cursor:default;
}

.theme-toggle{
  display:flex;gap:0;border:1px solid var(--border-2);border-radius:var(--radius);overflow:hidden;
}
.theme-opt{
  padding:6px 14px;font-size:12px;font-weight:600;
  background:transparent;color:var(--text-2);
  border:none;border-radius:0;box-shadow:none;cursor:pointer;
  transition:var(--transition);
}
.theme-opt:hover{background:var(--surface-2)}
.theme-opt.active{
  background:var(--accent);color:#fff;
}

.settings-select{
  padding:6px 10px;border-radius:var(--radius);
  border:1px solid var(--border-2);background:var(--surface-2);
  color:var(--text);font-size:13px;font-weight:600;
  cursor:pointer;
}
.settings-select:focus{outline:none;border-color:var(--accent);box-shadow:var(--focus)}

/* -------- Light Theme -------- */
html.theme-light{
  --bg:#f6f6f3;
  --surface:#fbfbfd;
  --surface-2:#eff0f4;
  --border:rgba(0,0,0,0.06);
  --border-2:rgba(0,0,0,0.10);
  --accent:#3a6bd6;
  --accent-soft:rgba(58,107,214,0.08);
  --accent-mid:rgba(58,107,214,0.18);
  --danger:#c23a3a;
  --danger-soft:rgba(194,58,58,0.08);
  --text:#1f1f26;
  --text-2:#5f5f6b;
  --text-3:#8a8aa0;
  --shadow:0 2px 10px rgba(0,0,0,0.08), 0 16px 34px -18px rgba(0,0,0,0.20);
  --wave-bg:#eef0f4;
}
html.theme-light body{-webkit-font-smoothing:auto}
html.theme-light .tabbar{background:rgba(246,246,243,0.92)}
html.theme-light .transport-btn{background:var(--surface);border-color:var(--border-2)}

/* -------- Help overlay -------- */
.help-content{padding:4px 0;font-size:13px;line-height:1.6;color:var(--text)}
.help-content h3{margin:12px 0 4px;font-size:14px;font-weight:700;color:var(--text)}
.help-content p{margin:0 0 8px}
.help-content ul{margin:0 0 8px;padding-left:18px}
.help-content li{margin-bottom:4px}

/* -------- Overlays -------- */
.overlay{
  position:fixed;inset:0;z-index:2000;
  display:flex;align-items:center;justify-content:center;
  padding:16px;
  background:rgba(0,0,0,0.60);
  -webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);
}
.overlay-card{
  width:min(480px,100%);max-height:min(82vh,640px);overflow:auto;
  border:1px solid var(--border-2);border-radius:var(--radius-lg);
  background:var(--surface);box-shadow:var(--shadow);padding:18px;
}
.overlay-card h2{margin:0 0 10px;font-size:16px;font-weight:700;letter-spacing:-.2px}
.overlay-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:14px}

.text-input{
  width:100%;padding:10px 12px;border-radius:var(--radius);
  border:1px solid var(--border-2);background:var(--surface-2);
  color:var(--text);font-size:14px;
}
.text-input:focus{outline:none;border-color:var(--accent);box-shadow:var(--focus)}

/* Playlist editor overlay rows */
.playlist-rows{display:grid;gap:8px;margin-top:12px}
.pl-row{
  display:grid;grid-template-columns:1fr 100px;gap:8px;align-items:center;
  padding:8px 10px;border:1px solid var(--border);border-radius:var(--radius);
  background:var(--surface-2);
}
.pl-row.dragging{opacity:.85;outline:1px solid var(--accent-mid)}
.pl-name-wrap{display:flex;align-items:center;gap:8px;min-width:0}
.pl-handle{
  width:36px;height:36px;display:grid;place-items:center;
  border-radius:6px;background:var(--surface);border:1px solid var(--border-2);
  color:var(--text-2);font-weight:800;font-size:14px;
  -webkit-user-select:none;user-select:none;touch-action:none;cursor:grab;
}
.pl-row.dragging .pl-handle{cursor:grabbing}
.pl-name{
  font-size:13px;font-weight:600;color:var(--text);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.pl-reps{
  width:100%;padding:8px;border-radius:6px;border:1px solid var(--border-2);
  background:var(--surface);color:var(--text);font-size:13px;
}
.pl-reps:focus{outline:none;border-color:var(--accent);box-shadow:var(--focus)}
.pl-reps[disabled]{opacity:.45}

.picker-list{display:grid;gap:6px;margin-top:8px}
.picker-list button{
  width:100%;text-align:left;background:var(--surface-2);color:var(--text);
  border:1px solid var(--border);box-shadow:none;padding:10px 14px;font-size:13px;
}
.picker-list button:hover{background:var(--surface)}

/* -------- Drop zone -------- */
#dropZone{
  border:2px dashed var(--border-2);padding:14px;border-radius:var(--radius);
  background:var(--surface);font-size:13px;color:var(--text-2);transition:var(--transition);
  box-shadow:var(--shadow);
}
#dropZone.drag-hover{border-color:var(--accent);background:var(--accent-soft);color:var(--text)}

.url-input{
  min-width:220px;flex:1;padding:8px 12px;border-radius:var(--radius);
  border:1px solid var(--border-2);background:var(--surface-2);color:var(--text);font-size:13px;
}
.url-input:focus{outline:none;border-color:var(--accent);box-shadow:var(--focus)}
.source-badge{display:inline-block;margin-left:4px;padding:2px 6px;font-size:10px;background:var(--surface-2);color:var(--text-2);border-radius:999px;letter-spacing:.4px}

/* -------- Tab bar -------- */
.tabbar{
  position:fixed;left:0;right:0;bottom:0;
  padding:6px 12px calc(6px + env(safe-area-inset-bottom));
  display:flex;justify-content:center;gap:4px;
  z-index:50;
  background:rgba(17,17,20,0.82);
  -webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);
  border-top:1px solid var(--border);
}
.tabbar .tab{
  background:transparent;border:none;box-shadow:none;
  color:var(--text-3);padding:8px 14px;border-radius:999px;
  font-size:12px;font-weight:600;letter-spacing:.1px;
}
.tabbar .tab.active{
  color:var(--text);background:var(--surface-2);
}
.tabbar .tab+.tab{margin-left:2px}

#audioOut{display:none}

/* -------- Landscape viz -------- */
#viz{display:none}
html.landscape body{overflow:hidden}
html.landscape .app-shell{display:none!important}
html.landscape #viz{display:block;position:fixed;inset:0;width:100vw;height:100vh;z-index:9999;pointer-events:none}
html.landscape .overlay{display:none!important}

/* -------- Desktop viz toggle -------- */
.desktop-only{display:none!important}
@media(min-width:768px){button.desktop-only{display:grid!important}.desktop-only.desktop-viz-card{display:block!important}}
#desktopVizBtn[aria-pressed="true"]{color:var(--accent);border-color:var(--accent-mid);background:var(--accent-soft)}
.desktop-viz-card{padding:0;overflow:hidden;height:140px;background:var(--wave-bg,#0f141b);position:relative}
#desktopViz{display:block;width:100%;height:100%}
.desktop-viz-fs-btn{position:absolute;top:6px;right:6px;width:32px;height:32px;border-radius:6px;border:none;background:rgba(255,255,255,.12);color:var(--text);display:grid;place-items:center;cursor:pointer;padding:0;opacity:.6;transition:opacity .15s ease,background .15s ease;z-index:2}
.desktop-viz-fs-btn:hover{opacity:1;background:rgba(255,255,255,.22)}
.desktop-viz-fs-btn svg{width:16px;height:16px}
.desktop-viz-card.fullscreen{position:fixed!important;inset:0!important;width:100vw!important;height:100vh!important;z-index:9999!important;border-radius:0!important;margin:0!important}

/* -------- Scroll lock -------- */
html.no-scroll,body.no-scroll{overflow:hidden!important}
.no-scroll input:focus,.no-scroll textarea:focus,.no-scroll [contenteditable="true"]:focus{outline:none}

/* -------- Misc -------- */
.fade{animation:fadeIn .25s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.loop-info{margin-top:8px;font-size:13px;color:var(--text);font-weight:500}
.range-label{font-size:11px;letter-spacing:.5px;color:var(--text-2)}
.footer-note{margin-top:20px;font-size:10px;text-transform:uppercase;letter-spacing:.8px;color:var(--text-3);text-align:center}

/* -------- Responsive -------- */
@media(max-width:520px){
  .controls button,.imports button{flex:1 1 auto}
  .detail-edit-controls{padding-left:0;grid-template-columns:1fr}
  .trim-actions{flex-direction:column}
  .trim-actions button{flex:none;width:100%}
}
@media(min-width:600px){
  .app-shell{max-width:600px}
}
